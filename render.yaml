services:
  # Gateway (Node runtime)
  - type: web
    name: gateway
    runtime: node
    plan: free
    rootDir: gateway
    buildCommand: npm ci
    startCommand: npm start
    envVars:
      - key: NODE_VERSION
        value: "22.16.0"
      - key: PRODUCTS_URL
        fromService:
          type: web
          name: products
          envVarKey: RENDER_EXTERNAL_URL
      - key: USERS_URL
        fromService:
          type: web
          name: users
          envVarKey: RENDER_EXTERNAL_URL
      - key: ORDERS_URL
        fromService:
          type: web
          name: orders
          envVarKey: RENDER_EXTERNAL_URL

  # Products (Go, public)
  - type: web
    name: products
    runtime: docker
    dockerfilePath: ./services/products/Dockerfile
    dockerContext: ./services/products
    plan: free
    envVars:
      - key: PORT
        value: "10000"
      - key: DATABASE_URL
        fromDatabase: { name: products-db, property: connectionString }

  # Users (Go, public)
  - type: web
    name: users
    runtime: docker
    dockerfilePath: ./services/users/Dockerfile
    dockerContext: ./services/users
    plan: free
    envVars:
      - key: PORT
        value: "10000"
      - key: DATABASE_URL
        fromDatabase: { name: products-db, property: connectionString }

  # Orders (Go, public)
  - type: web
    name: orders
    runtime: docker
    dockerfilePath: ./services/orders/Dockerfile
    dockerContext: ./services/orders
    plan: free
    envVars:
      - key: PORT
        value: "10000"
      - key: DATABASE_URL
        fromDatabase: { name: products-db, property: connectionString }

  # Gradio UI (public)
  - type: web
    name: gradio-ui
    runtime: docker
    dockerfilePath: ./gradio_ui/dockerfile
    dockerContext: ./gradio_ui
    plan: free

databases:
  - name: products-db
    plan: free
